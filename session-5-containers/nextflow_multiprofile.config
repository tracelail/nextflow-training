/*
 * Session 5: Multi-Profile Container Configuration
 * 
 * This config supports Docker, Singularity, Apptainer, and test profiles
 * Use with: nextflow run 02_multiprofile_container.nf -profile docker
 */

// Default parameters
params {
    // Input/output
    input = 'data/*.fastq'
    outdir = 'results'
    
    // Processing parameters
    num_reads = 50
}

// Profile configurations
profiles {
    
    // Docker profile for local development
    docker {
        docker.enabled = true
        docker.runOptions = '-u $(id -u):$(id -g)'
        
        process {
            cpus = 2
            memory = '4.GB'
        }
    }
    
    // Singularity profile for HPC environments
    singularity {
        singularity.enabled = true
        singularity.autoMounts = true
        
        process {
            cpus = 4
            memory = '8.GB'
        }
    }
    
    // Apptainer profile (modern Singularity alternative)
    apptainer {
        apptainer.enabled = true
        apptainer.autoMounts = true
        
        process {
            cpus = 4
            memory = '8.GB'
        }
    }
    
    // Test profile with minimal resources
    test {
        docker.enabled = true
        docker.runOptions = '-u $(id -u):$(id -g)'
        
        params {
            num_reads = 10  // Fewer reads for faster testing
        }
        
        process {
            cpus = 1
            memory = '2.GB'
        }
    }
}

// Default process configuration (used when no profile matches)
process {
    cpus = 2
    memory = '4.GB'
    
    // Error handling
    errorStrategy = 'retry'
    maxRetries = 2
}

// Execution reports
report {
    enabled = true
    file = "${params.outdir}/reports/execution_report.html"
}

timeline {
    enabled = true
    file = "${params.outdir}/reports/timeline.html"
}

trace {
    enabled = true
    file = "${params.outdir}/reports/trace.txt"
}

// Manifest metadata
manifest {
    name = 'Session 5: Container Profiles'
    author = 'Nextflow Training'
    description = 'Learn container configuration with Docker and Singularity'
    mainScript = '02_multiprofile_container.nf'
    version = '1.0.0'
    nextflowVersion = '>=25.04.0'
}
